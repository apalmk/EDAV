---
title: "EDAV Fall 2019 PSet 5, part A"
author: "Anjani Prasad Atluri, Amaury Sudrie, Maxime Tchibozo, Thomas Causero"
output:
  html_document:
    df_print: paged
  pdf_document: default
---
```{r, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = TRUE)
```


### 2. The Questions

[6 points]

List three questions that you hope you will be able to answer from your research.

a) We will be testing our assumption that movie production houses tend to look at old patterns of movie genres and     their financial success and try to make more movies of similar genre to earn high revenues. We do this by making a scatter plot between no of movies of a particular genre in a taken year and the revenue generated by the movies of this genre from the previous years. For example with the assumption that a movie takes 2 years to make on an average, we will take the number of movies made in each major genre in 2018  (on y-axis) and plot them against the revenue of these genres from the year 2016 (on x-axis). If there is a strong correlation, it means that since the movies belonging to these genres have performed well financially in 2016, more of such movies were made in 2018.

b) We see that nowadays many of the yesteryear's famous directors (like Martin Scorsese) are coming out and speaking up against the monopoly of super hero films over the theaters. We will use our superhero dataset see the trend in the ratio of no of theaters allocated to the superhero movies over the years. We will also test to see if these movies are indeed like the "themepark" (full of spectacle and poor quality) movies that these famous directors claim them to be. We would also like to see the relation between their budget and revenue and their release date and revenue (we assume that the newer superhero movies get more revenue due to the superhero bubble rather than actual quality of the film), and their quality (critics score) and revenue. If we find a strong positive correlation between the quality and revenue, we can reject our assumtion that the huge amounts of revenue they're generating is just due to the superhero movie bubble and not due to their actual quality.

c) We want to see how the bankable directors of the older generations have performed over the years leading up to 2019. We define the bankability of a director based on the revenue generated by his movies. We take the top 5 bankable directors of the deacade from 1980 to 1990 and see if their movies made it to the top 250 highest grossing movies list of other years leading upto 2019 (for our dataset we have collected the top 250 higest grossing movies per year from the years 1980 to 2019 from TMDB database), if their movies made it, we will draw a time series graph of their revenue. Through this we can see the financial performance of their movies over the years, and see if they are still bankable or not.



### 4. The Data

What is your data source?  What is your method for importing data? Please be specific. Provide relevant information such as any obstacles you're encountering and what you plan to do to overcome them.

[5 points]

We are collecting our data from multiple sources, and augmenting it from a few other sources. We first used "tmdb simple" which is a python wrapper for "The movie Database" API to collect data on top 250 highest revenue generating movies from the years 1980 to 2019. The data includes but is not limited to the release date, rating, director, revenue, budget etc. The major reason we selected TMDB database instead of IMDB is because IMDB database has the genres of the movies listed in alphabetical order, but TMDB listed them in the order of relevance to the movie. We initially faced issues with the rate limit of the API, which is 4 queries per second, to resolve this issue we set some waiting time after a couple of queries. We then stored this data in a csv file and imported into R and stored it as a dataframe.

For our analysis we needed an auxilliary dataset of superhero movies, we created our own dataset for this. The list of the superhero movies and the links to their corresonding imdb, rotten tomatoes and box office mojo pages were collected from wikipedia. The major problem with this was that not all movies had these links. Since there are not many superhero movies that lacked these links, we manually added them. After getting these links we scraped these pages to get details like release date, revenue, budget, no of theaters allocated to these movie etc. For helping our analysis with superhero dataset we also needed the details like no of theaters that were present in the US at the time of the release of these movies, and the average ticket price in the year of the release of these movies. This data was obtained from NATO (National Theater Owners Association).

### 5. Provide a short summary, including 2-3 graphs, of your initial investigations. 

<h1>I. Introduction </h1>

<h1>II. Data Sources </h1>

<h1>III. Data Transformation </h1>
Converted the years into numeric, 



```{r, echo=FALSE}
#load libraries
library(dplyr)
library(tidyverse)
library(parcoords)
library(shiny)
library(shinythemes)
library(readr)
library(viridis)
library(ggplot2)
library(gganimate)
library(ggthemes)
library(plotly)
library(GGally)
```

## R Markdown

1. NA Analysis:

Some NA values in this dataset have been imputed to 0s in certain columns and None in other columns, we make them back into NAs. To be specific some NAs in the budget, and revenue were imputed to 0 and the NAs in the runtime were imputed to 'None'. Since we know that the budget, revenue and runtime certainly cannot be equal to zero or None, we can safely conclude that they have been imputed to 0s and make them back to NA again for our analysis. Genres column also has NA values which are present as empty strings, we are making them into NAs.
```{r}
dfg=read.csv('dataset1_4000.csv',sep=";")
dfg$budget <- replace(dfg$budget, dfg$budget == 0, NA)
dfg$revenue <- replace(dfg$revenue, dfg$revenue == 0, NA)
dfg$runtime <- replace(dfg$runtime, dfg$runtime == 'None', NA)
dfg$genres=replace(dfg$genres, dfg$genres == '', NA)

pr1=colSums(is.na(dfg))/nrow(dfg)*100
sort(pr1,decreasing = TRUE)
```

We can see that the budget column has the highest no of NAs, followed by revenue, runtime, genres, and director. No other columns have any NA values.

Let us now try to visualize the missing patterns:
```{r}
library(extracat)
nm1=dfg
colnames(nm1)=c("director","id","title","popularity","budget","revenue","genres","VC","VA","runtime","RD")
visna(nm1, sort='b')
```
Note: The names of some variables have been re-coded in the interest of space. ("title"="original title","VC"="Vote count","VA"="Vote Average", "RD"="release date").

We see something interesting here, even though from the plot it looks like many rows are missing runtime, genre, and the director details, we found on careful examination of the dataset that the missing values of the director column, genre column and the runtime column have more no of unique missing patterns than the other columns, since visna compiles all the rows with similar missing patterns into one single row, and since most of the missing patterns of director, genre and the runtime are unique it looks like they are more in number. 

In rows patterns we can see that of all the rows that are having missing values, most no of rows are missing budget details. The highest missing values are in the column budget, and then revenue and then runtime, then there are a few in genre and a few in director.

We can see that whenever revenue of a movie is missing, budget is also missing.

Let us now add an extra column to our dataset with its values as no of NAs in the row (i.e. no of missing value per movie). Let us also check our assumption that movies of bad quality (low total ratings (total rating values are obtained by multiplying no of votes with vote average of each movie)), or the movies that are less popular or the movies that are old have more NA values. We draw a scatter plot matrix for ratings score, year of release, popularity and no of NA values in the row to check if a correlation exists.

```{r}

#Extracting the year of release
dfgg= dfg %>% mutate(year=as.numeric(substring(release_date,1,4)))

#Summing up all the NAs in a row
v=as.data.frame(rowSums(is.na(dfgg)))
dfg1=cbind(dfgg,v)
dfg1 <- dplyr::rename(dfg1, na_sum = `rowSums(is.na(dfgg))`)
dfg1=mutate(dfg1, tot_rating=vote_count*vote_average)
dfg2 = select(dfg1,popularity,year,tot_rating,na_sum)

#Selecting only the rows that have NA values
dfg3=filter(dfg2,dfg2$na_sum!=0)
ggpairs(dfg3,progress=FALSE)
```
Though there is a slight negative correlation between the popularity, release year, total rating and the number of NA values, it is not strong enough to strenghten our assumption. But from the plots we can see that higher no of missing values (more than 2 missing values) in a row (per movie) are fairly concentrated for the movies that were released before 1990. It is the same with popularity and total rating too, i.e. there are more no of NAs for movies with popularity below 40, and we can also see that no movie above 50 popularity actually has an NA value except an outlier (movie Frozen II, with missing budget value). Most of the movies that are having missing values are missing budget value irrespective of their popularity, year of release or total rating.

Let us now remove the rows containing NA values from our dataset for our analysis from here on. We will save this as our clean dataset, and since we have extracted the years of the movies from the release date, this will have years column seperately in numeric format.
```{r}
new_df=na.omit(dfgg)
#We lost 747 movies after removing the NA values from the dataset
write.csv(new_df,"/Users/ap/Documents/EDAV_assignments/clean_data.csv", row.names = FALSE)
```





```{r}
dff <- read.csv('clean_data.csv')
```

The dataset we are woking with is composed of 3932 rows and 12 columns, each representing a movie with several characteistics such as: director, title, popularity, budget, revenue, genre, ratings or date.
In all the study, we plotted as many relevant graphs as possible, using specific colors, so that even people with color vision deficiency can look at the graphs easily. 

## Get all movies genres

```{r, warning=FALSE, echo=TRUE}
#Only keep the first genre, which is the most relevant
genres1 <- do.call(rbind,strsplit(as.character(dff$genres),'\\|'))[,1]
df1 <- data.frame(genres = genres1, select(dff, -genres))
unique(as.character(df1$genres))
```

In the original dataset, there are many genres for each movie. The first genre is the most relevant, the others bring more precision but we are not going to consider them in our study. Then, we only kept the first genre for each movie for the rest of the study.

```{r}
#plot (number of movies for each genre)
genres_info <- df1 %>%
               count(genres) %>%
               mutate(perc =  (n / nrow(df1))*100)

ggplot(genres_info, aes(x = reorder(genres,n), y = n)) + 
  geom_bar(stat = "identity") + 
  xlab('Genre') +
  ylab('Volume') +
  ggtitle('Distribution of movies (Volume)') +
  coord_flip()

ggplot(genres_info, aes(x=reorder(genres,n), y=perc)) + 
  geom_bar(stat = 'identity') + 
  xlab('Genre') +
  ylab('%') +
  ggtitle('Distribution of movies (%)') +
  coord_flip()
```

On our dataset, the 5 most present genres are:
* Comedy (~22%)
* Action (~20%)
* Drama (~18%)
* Adventure (~8%)
* Horror (~7%)
We are going to focus our study on these genres, which represent 75% of the whole dataset.

## 5 most present genres
We are choosing 5 most present genres in our dataset for the analysis from here on.
```{r}
#5 most present genres : Comedy, Action, Drama, Adventure, Horror
genres_under_study <- arrange(genres_info,-n)[1:5,'genres'][['genres']]
genres_under_study
#only keep rows whose genre is among the top 5
df2 <- filter(df1, genres %in% as.vector(genres_under_study))


resultss =df2 %>%
  dplyr::group_by(year, genres) %>%
  dplyr::summarise(budget = mean(budget, na.rm = T), revenue = mean(revenue), 
            mark = sum(vote_average*vote_count)/sum(vote_count)) %>% ungroup()

ggplot(data = resultss) + 
  geom_line(aes(x = year, y = budget, color=genres)) + 
  scale_color_colorblind() +
  ggtitle('Evolution of budget of each genre over the year')

ggplot(data = resultss) + 
  geom_line(aes(x = year, y = revenue, color=genres)) + 
  scale_color_colorblind() +
  ggtitle('Evolution of revenue of each genre over the year')

ggplot(data = resultss) + 
  geom_line(aes(x = year, y = mark, color=genres)) + 
  scale_color_colorblind() +
  ggtitle('Evolution of ratings of each genre over the year')
```


What is return on investment.
```{r, warning=FALSE}
#x axis is the genre, bar graph
df3=read.csv("main_ds_without_superhero.csv")
#Removing one movie whose budget is misrepresented as 2 dollars
df3<-df3[!(df3$budget==2 ),]
#Removing movie with wrong details
df3<-df3[!(df3$id==506972 ),]
df3<-df3[!(df3$id==506664 ),]
df3<-df3[!(df3$id==503314 ),]

genres1 <- do.call(rbind,strsplit(as.character(df3$genres),'\\|'))[,1]
df4 <- data.frame(genres = genres1, select(df3, -genres))
df4 <- select(df4,genres,revenue,budget,original_title)
df4 <- filter(df4, genres %in% as.vector(genres_under_study))
df4 <- dplyr::mutate(df4,ROI = (revenue-budget)/budget)
df4 %>%
  dplyr::group_by(genres) %>%
  dplyr::summarise(average_ROI = mean(ROI)) -> resultss2

ggplot(resultss2) + 
  geom_bar(aes(x=reorder(genres,-average_ROI), y=average_ROI), stat='identity') +
  xlab('Genres') +
  ylab('Average Return on Investment')+
  ggtitle('ROI depending on genres ')
```
Note: ROI doesn't have a unit of measurement, in general the higher the ROI, the more value we receive for investment.

After removing the suspicious movies that did not have consistent budget and revenue data, we end up with this graph. We can see that horror movies have a very high average return on investment. This is because they are not expensive to make, and if they are good they generate a huge revenue. After filtering and checking the data, we found that the movie with the highest ROI is "Paranormal Activity 2009" which had a budget of 15,000 dollars and made 193 million dollars globally. The second highest is "The Blair Witch Project" which is the first ever found footage genre movie. It was made on a budget of 60,000 dollars and generated a revenue of 248 million dollars. These movies increased the average ROI of the Horror genre. Even without these movies "Horror" movies had a higher ROI than other genres. When observing the comedy genre, we found that a Japanese zombie comedy movie called "One Cut of the Dead" was made on a budget of 30,000 dollars and generated a revenue of 200 million dollars after its international release. This movie alone is one of the reaons for the high average ROI of comedy movies. Of the movies belonging to the Drama genre, the movie with highest ROI is a Hindi movie "Secret Superstar" it had a ROI of 479. 


Let us now see how many of the top 100 highest grossing movies of each year (our dataset has top 100 highest grossing movies of each year from 1980 to 2019, we have lost some movies after removing NA values) have one of the 5 genres we're considering (Action, Adventure, Comedy, Drama, Horror) as main genre (Since we have extracted only the main genre from the genre column of each movie). Since we have the data from 1980 to 2019, we would have to draw one bar graph per year to show this, which is unnecessary. Let us instead visualize these graphs in animation, 
```{r}
#reference https://towardsdatascience.com/create-animated-bar-charts-using-r-31d09e5841da
cv= data.frame(df2 %>% dplyr::group_by(year,genres) %>% dplyr::summarise(cnt = n()) %>% ungroup())

#giving ranking to cv for the order maintenance
cv_formatted <- cv %>%
  dplyr::group_by(year) %>%
  #breaks ties randomly
  dplyr::mutate(rank = rank(-cnt,ties.method = "random"),
         cnt_lbl = paste(" ",cnt)) %>% dplyr::ungroup()
trial=filter(cv_formatted, year<1983)
sp = ggplot(cv_formatted, aes(rank, group = genres, 
                fill = as.factor(genres), color = as.factor(genres))) + scale_colour_colorblind() + scale_fill_colorblind()+
  geom_tile(aes(y = cnt/2,
                height = cnt,
                width = 0.8), alpha = 0.9, color = NA) +
  geom_text(aes(y = 0, label = paste(genres, " ")), vjust = 0.2, hjust = 1, size=7) +
  geom_text(aes(y=cnt,label = cnt_lbl, hjust=0),size=7) +
  coord_flip(clip = "off", expand = FALSE) +
  scale_y_continuous(labels = scales::comma) +
  scale_x_reverse() +
  guides(color = FALSE, fill = FALSE) +
  theme(axis.line=element_blank(),
        axis.text.x=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks=element_blank(),
        axis.title.x=element_blank(),
         axis.title.y=element_blank(),
        legend.position="none",
        panel.background=element_blank(),
        panel.border=element_blank(),
        panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        panel.grid.major.x = element_line( size=.1, color="grey" ),
        panel.grid.minor.x = element_line( size=.1, color="grey" ),
        plot.title=element_text(size=23, hjust=0.55, face="bold", colour="grey", vjust=-1),
        plot.background=element_blank(),
       plot.margin = margin(2,2, 2, 4, "cm"))

anim = sp + transition_states(year, transition_length = 3, state_length = 2) +
  view_follow(fixed_x = TRUE)  +
  labs(title = 'No of movies each of our 5 major genres made in Year: {closest_state}')

animate(anim, duration=70, fps = 20,  width = 1500, height = 1000, 
        renderer = gifski_renderer())
anim_save("bar_anim.gif")
```

We can see from the animation that for the most part horror was ranked last, and was never on the top spot, implying that in the 5 genres we're considering, it never so happened that more horror movies were present in the top 100 highest grossing films of a year (from 1980 to 2019) than the other 4 genres we're considering. This tells us that even though horror movies have their audience, they generally are a niche genre and don't have a very wide appeal like other genres like action or drama. This is the reason why there are not as many horror movies in the dataset as the other genre movies we're considering. We can also see that action movies were at the top spot consistently for the last 9 years. This implies that for the past 9 years, most of the top 100 highest grossing movies had their main genre as action. Drama movies were mostly fluctuating between 2nd and 3rd position and were rarely present at the 1st or 4th spots. There was stretch of years from 2004 to 2007 during which the ranks (or relative positions) of the genres in the graph remained same. During those years, in the top 100 highest grossing movies there were more Comedy movies, followed by Drama, followed by Action, followed by Adventure and Horror movies at the end. This shows movies having their main genre in that aforementioned order were present more (in the same order given before i.e. most of them are Comedy, then Drama, then Action, then Adventure and at last Horror) in the top 100 highest grossing films of the years from (2004 to 2007). Since the revenue generated by a movie translates to the number of people that watched, which in turn says something about the preference of people in those years, we can safely say that most audiences preferred movies whose main genre is Comedy, followed by movies whose main genre was Drama, then Action and then Horror. Surprisingly, this order of preference lasted from 2004 to 2007.

III. Director Analysis

In this part of our analysis let us see how the top bankable directors (the bankability is determined by the revenue generated by their movies, the higher the revenue, the higher the bankability) of older years have been performing over the years. We will take the top 6 directors based on the financial performance of their movies from the year 1980 to 2000. We will then see how the movies they made after the year 2000 have been performing. This will help us see if the movies of these directors are consistently performing well.  

```{r}
most_generating <- filter(dff, year <= 2000)
most_generating <- most_generating[c("director", "revenue")]
most_generating <- most_generating %>% dplyr::group_by(director) %>%
                    dplyr::summarize(revenue = sum(revenue, na.rm = TRUE)) %>% ungroup()
most_generating  <-  arrange(most_generating,desc(revenue))

#Getting the 6 top directors based on the financial performance of their movies
six_directors <- data.frame(head(most_generating, n=6))
six_directors=as.character(six_directors$director)
directors <- filter(dff, year >= 2001)
directors <- filter(directors, director %in% six_directors)
directors <- directors[c("director", "revenue", "year","original_title")]
directors <- directors %>% dplyr::group_by(director, year) %>%
                    dplyr::summarize(revenue = mean(revenue, na.rm = TRUE)) %>% ungroup()
resultss$genres <- factor(resultss$genres, levels = c('Adventure', 'Action', 'Drama', 'Comedy','Horror'))

                    directors$director= factor(directors$director, levels = c('James Cameron', 'Roland Emmerich', 'Chris Columbus', 'Steven Spielberg','Robert Zemeckis','Richard Donner'))

directors["revenue"] <- lapply(directors["revenue"], function(x){return(x/100000000)})

p<-ggplot(data = directors, aes(x=year, y=revenue, color=director)) +
  geom_point() +
  geom_line() +
  scale_color_viridis_d() +
  ggtitle("Revenues of the of movies top bankable Directors (from 1980 to 2000) during the 21st century") +
  labs(x = "year", y = "Revenue (in 100 millions of dollars)")

p1<-ggplotly(p) %>% config(displayModeBar = F)
ggplotly(p1)
```
When hovering over the points we can see the revenue, year and the name of the director. Clicking on the legend will remove the line of that director and will provide for a better view of other line plots.

Note: One would expect to see the title of the movie too when hovering over the point, but this is not possible, as one director would have made more than 1 movie in the same year (Two movies of Spielberg "Minority Report" and "Catch Me If You can" released in 2002, another two movies of Spielberg "War of the Worlds" and "Munich" released in 2005 and yet again two more of Spielberg movies "Adventures of Tintin" and "The war horse" released in 2011). In such cases we are taking the average of the revenue of the movies released that year. 

We can see that only two directors released their movies in the year 2001, Spielberg released "A.I. Artificial Intelligence" a sci-fi movie and Chris Columbus released Harry Potter and the Philosopher's Stone. We can see that Harry Potter generated more revenue than "A.I." this can attributed to several aspects like the international  appeal of the books, this would have easily caused a lot of hype than Spielberg's "A.I.". The same directors again released their movies in 2002, this time Chris Columbus released "Harry Potter and the Chamber of Secrets" and Spielberg released "Minority Report" and again Harry Potter performed better than "Minority Report". In 2004 Roland Emmerich released "The Day After Tommorow" and Robert Zemeckis released "The Polar Express", and Spielberg released "The Terminal", and "The Day After Tomorrow" performed better than the other two at the box-office.

We can see from the data that Spielberg was more active by releasing a high number of  movies (he released 11 movies in 18 years (from 2001 to 2019)). The director who made the lowest number of movies in this time span from 2001 to 2019 is James Cameron, who only released one movie which is "Avatar" and it shattered all the records. It is the movie that caused the scale of our y-axis to be so high. Then comes Richard Donner who made two movies in these years, namely "Timeline" and "16 blocks" which didn't do really well at the box-office. The peak in 2008 for Spielberg was due to the movie "Indiana Jones and the Kingdom of Crystal Skulls" and the peak in 2009 for Roland Emmerich was for the movie "2012". Though Spielberg made more movies, their revenues were not very consistent, Robert Zemeckis made 6 movies in the time span we took, and even though their revenues were not as good as Spielberg's movies, they were more consistent. Chris Columbus made 4 movie out of which 2 are from the "Harry Potter" franchise and one is from "Percy Jackson" franchise and one is the movie "Pixels". The revenue generated by "Pixels" and "Percy Jackson: The Lightning Thief" is nowhere near the revenue generated by the Harry Potter movies (without even accounting for inflation as both the Harry Potter movies are older compared to "Pixels" and "Percy Jackson"). In the year 2008, Spielberg's "Indiana Jones and the Kingdom of the Crystal Skulls" was released and Roland Emmerich's 10,000 BC was released. Indiana Jones performed much better.

From the overall trend we can see that "James Cameron" made just one movie and it performed much better than the other movies. Chris Columbus's movies in 2010 and 2015 couldn't generate as high a revenue as the Harry Potter movies he made. The revenues of Roland Emmerich's and Spielberg's movies fluctuate more when compared to the movies of other directors in our plot. Richard Donner's movies haven't performed as well as the movies of his peers from our plot, and he didn't make any more movies after the year 2006.


Now out of these directors we have chosen let us see what genres they attempted and what genres most of their movies had. (This data is for the time span 1980 to 2019).
```{r}
versatile <- filter(df1, director %in% six_directors)
versatile <- versatile[c("director", "genres")]
ggplot(data = versatile, aes(x=genres)) +
  geom_bar(colour = "white", fill = "cornflowerblue") +
  facet_wrap(~director) +
  coord_flip() +
  ggtitle("Genres attempted by our top bankable directors") +
  labs(x = "Genres", y = "Count")
```

We can clearly see that Spielberg didn't play safe and attempted the most number of genres, 8 to be precise. He made 11 movies that had "Adventure" as their major genre and 11 movies that had "Drama" as their major genre and made one movie in the rest of the genres he attempted. The second most versatile director from our big 6 is Robert Zemeckis, who attempted 6 different genres in total and made 7 "Adventure" movies, 3 "Action" movies, 3  "Drama" movies, 2 "Comedy" movies and one "Fantasy" and "Animation" genre movie each. Ronald Emmerich made more action movies (6 to be precise) when comparing with other genres, and the same happened with James Cameron and Richard Donner. Richard Donner made the highest number of action movies of them all. Spielberg made the highest number of "Adventure" and "Drama" movies of them all. To see more interesting patterns within the genres of movies these directors attempted, let us make a heatmap.

```{r, fig.width=5, fig.height=7, warning=FALSE}
all_genres <- merge( data.frame(unique(versatile$genres)), data.frame(unique(versatile$director)) )
names(all_genres)[1] <- "genres"
names(all_genres)[2] <- "director"
versatile["total"] <- 1
versatile["freq"] <- 1
versatile <- versatile %>% group_by(director, genres, total) %>% summarize(freq = sum(freq))
versatile <- versatile %>% group_by(director) %>% mutate(total = sum(freq))
versatile <- merge(x=versatile, y=all_genres, by=c("genres", "director"), all.y = TRUE)
versatile["order"] <- 1
versatile <- versatile %>% mutate(order = freq/total)
versatile <- versatile %>% group_by(genres) %>% mutate(order = sum(order, na.rm = TRUE))
versatile$genres <- reorder(versatile$genres, versatile$order)
theme_heat <- theme_classic() +
  theme(axis.line = element_blank(),
        axis.ticks = element_blank())
plot <- ggplot(versatile, aes(x = director, y = genres) ) +
  geom_tile(aes(fill = freq/total), color = "white") +
  coord_fixed() + 
  theme_heat
# plot with text overlay and viridis color palette
plot + geom_text(aes(label = round(freq/total, 3)), color = "white") +
      scale_fill_viridis() +
      # formatting
      ggtitle("Genres attempted by our top bankable directors",
              subtitle = "Heatmaps of genres attempted by the six top bankable directors") +
      theme(plot.title = element_text(face = "bold")) +
      theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
      theme(plot.caption = element_text(color = "grey68"))
```

We can see an interesting pattern here, each one of them made at leat one movie in the "Action" genre, one movie in the "Adventure" genre and one movie in the "Drama" genre. Only Robert Zemeckis made a movie in the "Animation" genre. Chris Columbus made 3 comedy movies which is the highest from this set of directors. Spielberg is the only one in this group of directors to have attempted "Thriller", and "History" movies. Only Spielberg and Roland Emmerich made "Science Fiction" movies. Only 3 of the 6 directors ("Chris Columbus", "Robert Zemeckis", and "Spielberg") made Comedy movies. Only 3 of the 6 directors("Richard Donner","Robert Zemeckis" and "Steven Spielberg") made "Fantasy" movies.


Let us now look at the distribution of the average ratings of the movies made by these 6 most bankable directors. We will be using the vote average column (which is on the scale of 1 to 10) from our main dataset, in the following analysis.
```{r}
top_dir_ratings <- filter(df1, director %in% six_directors)
top_dir_ratings=top_dir_ratings[c("director", "vote_average", "vote_count")]
g1 = top_dir_ratings %>% group_by(director) %>% summarize(avg_rating = mean(vote_average, na.rm = TRUE)) %>% ungroup()

vb=ggplot(data= g1, mapping = aes(x=fct_reorder(director,-avg_rating), y=avg_rating))
vb + geom_col() + ggtitle("Average ratings of the movies of the top bankable directors") + scale_y_continuous(breaks = seq(0, 10, by = 1)) +
  labs(x = "Director", y = "Average rating on a scale of 10")
```

The average score is not as high as we would expect though and there is not huge difference between the average ratings of the top bankable directors. On exploring the dataset further we have seen that there are movies that had better ratings than the ones made by these directors, but they did not receive nearly as much revenue. This indicates that there should not be a strong positive correlation between the revenue generated by movies and their ratings (revenue generated by a movie is not dependent on it quality(rating)). To test this on our data let us quickly check if there is a correlation between the revenue and the average ratings of the movies in our data.
```{r}
cor(df1$revenue,df1$vote_average)
```
As we expected there is not a strong correlation between the revenue and the average ratings in our data. 

Let us now look at how much these directors generally spend on their movies:
```{r}
top_dir_budget <- filter(df1, director %in% six_directors)
top_dir_budget=top_dir_budget[c("director", "budget")]
top_dir_budget$budget=top_dir_budget$budget/1000000
g2 = top_dir_budget %>% group_by(director) %>% summarize(avg_budget = mean(budget, na.rm = TRUE)) %>% ungroup()

vb1=ggplot(data= g2, mapping = aes(x=fct_reorder(director,-avg_budget), y=avg_budget))
vb1 + geom_col() + ggtitle("Average budgets of the movies of the top bankable directors") + scale_y_continuous(breaks = seq(0, 130, by = 30))+
  labs(x = "Director", y = "Average budget in millions")
```
We can see that Roland Emmerich's movies have the highest budget on an average, is because he makes more "dystopian" movies, which will need a lot of visual and special effects, and these cost a lot of money. Though James Cameron did not spend a lot on "Titanic" the average budget rose due to the budget of "Avatar". The movies of Steven Spielberg and Robert Zemeckis cost almost the same amount of money to make. Richard Donner makes the least expensive movies of our top bankable directors.

Let us now look at the average return on investment of movies of these directors:
```{r}
top_dir_roi <- filter(df1, director %in% six_directors)
top_dir_roi=top_dir_roi[c("director", "budget","revenue")]

g3 = top_dir_roi %>% group_by(director) %>% summarize(avg_roi = mean((revenue-budget), na.rm = TRUE)) %>% ungroup()
g3$avg_roi=g3$avg_roi/1000000
vb2=ggplot(data= g3, mapping = aes(x=fct_reorder(director,-avg_roi), y=avg_roi))
vb2 + geom_col() + ggtitle("Average return on investment of the movies of the top bankable directors") + scale_y_continuous(breaks = seq(0, 700, by = 100)) +
  labs(x = "Director", y = "Average return on investment in millions")
```
If we consider the return on investment metric as profitability, we can see that James Cameron is the most profitable among the directors we have chosen, and this is primarily due to the movie "Avatar". He is nearly twice as profitable as the second director in the list. Richard Donner is the least profitable among the directors we are analyzing. But from the previous graphs we know that Richard Donner doesn't make high budget movies, and his revenue will be proportional to the budget he is investing in, because from our data we could see that there is a correlation between the budget and revenue of a movie (correlation coefficient of 0.665). So this will not be an accurate metric for measuring profitability, instead let us see how many dollars on an average all their movies are getting back for every dollar they spent (revenue/budget).

```{r}
top_dir_d <- filter(df1, director %in% six_directors)
top_dir_d=top_dir_d[c("director", "budget","revenue")]

g4 = top_dir_d %>% group_by(director) %>% summarize(avg_d = mean((revenue/budget), na.rm = TRUE)) %>% ungroup()

vb3=ggplot(data= g4, mapping = aes(x=fct_reorder(director,-avg_d), y=avg_d))
vb3 + geom_col() + ggtitle("Average Ratio of revenue and budget of the movies of our top directors") + scale_y_continuous(breaks = seq(0, 12, by = 1)) +
  labs(x = "Director", y = "No of dollars made per 1 dollar spent")
```
We can see that the order has changed and Chris Columbus's movies get back 11 dollars on an average for every dollar spent, Spielberg's movies get back 8.5 dollars for every dollar spent, and James Cameron's movies get 7.5 dollars for every dollar spent. Richard Donner's movies again get the least number of dollars (3 dollars) back for every dollar spent.

Which genres from our consideration genrally get high average ratings?
```{r}
gen_rat=df2
gen_rat=gen_rat[c("genres", "vote_average")]
g3 = gen_rat %>% group_by(genres) %>% summarize(avg_rating = mean(vote_average, na.rm = TRUE)) %>% ungroup()

vb=ggplot(data= g3, mapping = aes(x=fct_reorder(genres,-avg_rating), y=avg_rating))
vb + geom_col() + ggtitle("Average ratings received by movies of genres we're considering") + scale_y_continuous(breaks = seq(0, 10, by = 1)) +
  labs(x = "Genre", y = "Average rating on a scale of 10")
```

It is surprising to see that there is not a lot of difference in the average ratings received by the movies made in the genres we're considering. Dramas receiving high average can be expected, as it is like a general consensus that dramas are highest quality cinema (one simply needs to look at all the past best picture Oscar winners).







[10 points]

Obseravtion 1:
NA analysis
```{r}
library(dplyr)
library(plotly)
df=read.csv("clean_superhero.csv")
pr=colSums(is.na(df))/nrow(df)*100
sort(pr,decreasing = TRUE)
```

We can see from our superhero movies dataset that we don't have a lot of missing values, and most of the missing values are in opening weekend gross of movies. The theaters column has the number of theaters that were allocated to the movie. The gross_usa and the gross_worldwide columns show the gross amount made by the movie in the US and worldwide. The budget column gives the budget of the movie.

```{r}
library(extracat)
nm=df
colnames(nm)=c("name","imdb","rt","bm","imdbr","RD","budget","CS","AS","theaters","studio","year","opw","Gusa","Gwrld")
visna(nm, sort='b')
```

Note: The names of some variables have been re-coded in the interest of space. ("opw"="opening weekend gross","Gusa"="overall domestic gross,"Gwrld"="Worldwide gross","rt"="rotten tomato link", "imdbr"="imdb rating", "RD"="release date","CS"="Critics Score", "AS"="Audience Score").

We can see from the plot that most of the rows had all the values. In the rows having missing values, the most common missing pattern is the worldwide gross, US gross, number of theaters and opening weekend. We can see that whenever budget is missing, worldwide gross, USA gross, theater allocation, and opening weekend gross data are also missing.

Whenever the domestic gross is missing, the worldwide gross and the opening weekend collection are missing (which makes sense as without data on opening weekend collection we can't calculate the domestic gross and without domestic gross we can't calculate the worldwide gross). Whenever the theater allocation details are missing the opening weekend data is also missing.

Extracting release years from the release dates of the movies:

```{r}
dff1=df %>% mutate(year = substr(release_date, nchar(as.character(release_date))-10+1, nchar(as.character(release_date))))
dff1 = dff1 %>% mutate(year_of_release = substr(year, 1,4))
dff1$year_of_release=as.numeric(dff1$year_of_release)
```


Let us now see if there is any correlation between the release year, imdb score and the number of NAs in the row of the movie.
```{r}
library(GGally)
dff1=dff1 %>% mutate(NAs=rowSums(is.na(dff1)))
dff2 = select(dff1,year_of_release,imdb_rating,NAs)
#taking only the movies that have NA values in their rows
dff3=filter(dff2,dff2$NAs!=0)
ggpairs(dff3)
```

We can see that there is a strong negative correlation between the year of release and the number of NA values for the movies, that have missing values. It strengthens our suspicion that the missing budget, revenue, theater data values are because of the lack of records for the old superhero movies.

Martin Scorsese claimed that these superhero movies are like amusement parks, they provide joy to some viewers but cannot be called cinema in his view. On thinking about this claim, we came up with a metric to identify these kinds of movies. These would be movies that generally have not so good critics scores (below 60 on rotten tomatoes), a high-budget (above $100 million) and a worldwide gross above 500 million dollars. To see if movies with these characteristics exist in the superhero dataset we made an interactive paralell coordinate plot. For each of the variables (critics score, worldwide gross, and the budget) of the plot, the user may select a value range for these variables (by clicking and dragging over the axes) to see if such movies indeed exist.

```{r}
library(parcoords)
df <- read.csv("clean_superhero.csv")

df["critic_score_rt"] <- lapply(df["critic_score_rt"], function(x) as.numeric(gsub("%", "",x)))

par_plot = c(11,8,15,7)
dfj=df[,par_plot]
dfj$gross_worldwide=dfj$gross_worldwide/(1000000)
dfj$budget=dfj$budget/(1000000)
names(dfj)=c("studio","critics score","worldwide gross (in millions)", "budget (in millions)")

parcoords(dfj, brushMode = "1D-axes", reorderable = T, queue = T,rownames=F,color = list(colorBy = "studio",colorScale = "scaleOrdinal",colorScheme = "schemeCategory10"), withD3 = TRUE)
```

As we can see, there indeed exist such movies in the superhero dataset that are of "Amusement park" type. Having seen this let us get into the analysis of the other aspects of the superhero movies.

Let us look at the trend in the domestic gross revenue generated by the superhero movies over the years. If there are multiple superhero movies generated in a year we will add up their revenues.

```{r}
gross_year <- data.frame(release_date = dff1$year_of_release, gross_usa = dff1$gross_usa)
gross_year$gross_usa=gross_year$gross_usa/1000000
results <- data.frame(gross_year %>%
  dplyr::group_by(release_date) %>%
  dplyr::summarise(total_gross_usa = sum(as.double(gross_usa), na.rm = TRUE)))
results <- results[order(results['release_date']),]
results=na.omit(results)
ggplot(results, aes(release_date, y=total_gross_usa)) + 
  geom_line() +
  geom_point() +
  ggtitle("Total gross in USA over the years") + theme(plot.title = element_text(hjust = 0.5)) +
  scale_x_continuous(breaks=seq(min(results$release_date), max(results$release_date), 5))+
  xlab("Year") + 
  ylab("Gross in USA in millions")
```

We can see from the overall trend that the total gross generated by superhero movies in the domestic market has been increasing. From the magnitude of these sharp increases we can see that the increase in gross revenue in US is not just because of inflation. We can see a very sharp increase from 2015 to 2018; one of the major reasons for this is the higher number of superhero movies made in these years. We can see sharp dips in the gross collection in the years 2015, 2010 and 2009. To see why this happended let us make a bar graph to see number of superhero movies that were released during these years.


```{r}
ggplot(gross_year, aes(release_date)) + 
  geom_bar() + 
  ggtitle("Number of Superhero movies made over the years") + scale_x_continuous(breaks=seq(min(results$release_date), max(results$release_date), 5))+theme(plot.title = element_text(hjust = 0.5))+
  xlab("Year") + 
  ylab("Number of movies")
```

Six superhero movies were released in 2018, and 6 in 2019, but the dip in the revenue generated in 2019 is due to the fact that the movie "Joker" hasn't finished its full run yet and we only have its domestic gross till the time we collected the data, this brought down the average gross of 2019. We can see that 3 superhero movies were released in 2015 in contrast to the years before and after 2015 (which had more number of superhero movies), this explains the gross collections dip in 2015. The same can be said about 2009 and 2010. From the overall trend in the graph we can see that number of superhero movies being made over the years has been increasing.


Since total gross over the years is a metric that depends on the number of movies that were released in that year, let us see the total <strong>average</strong> gross of the superhero movies over the years.

```{r}
results1 <- data.frame(gross_year %>%
  group_by(release_date) %>%
  summarise(avg_gross_usa = mean(gross_usa, na.rm = TRUE)))
results1 <- results1[order(results1['release_date']),]
results1=na.omit(results1)

ggplot(results1, aes(release_date, y=avg_gross_usa)) + 
  geom_line() +
  geom_point() + scale_x_continuous(breaks=seq(min(results1$release_date), max(results1$release_date), 5))+theme(plot.title = element_text(hjust = 0.5)) +
  ggtitle("Average gross in USA over the years") +
  xlab("Year") + 
  ylab("Gross in USA in millions")
```

In 1978 Superman was released, and from then on other superhero movies were released but they couldn't perform as well as Superman of 1978 till Batman Returns in 1992. Some movies that came in the middle (1978-1992) are Supergirl in 1984, Superman IV in 1987. Batman in 1989 started to revive the revenues of the superhero movies again. The peak in 2002 is due to the movies "Blade" and "Spiderman" both of which are character from Marvel comics. The dip in 2005 was due to the movies Batman Begins, Constantine and Electra. Even though Batman Begins performed well the revenue generated in that year is brought down by the poor performance of Constantine and Electra (both are characters from Marvel comics). The same goes for 2010, where Iron Man 2 performed well but the average is brought down due to the movie Jonah Hex. The peak in 2013 is due to a slew of superhero movies, namely Iron Man 3, Man of Steel, The Wolverine and Thor: The Dark World. We can see that the years that generated high revenues saw the releases of movies about relatively well known superheroes and have gotten good revenues if the movie had high ratings (implying good quality). But to verify this claim, we will do a scatter plot between the ratings (critics and users) of the movie and the revenue it generated to see if the movies have gotten good revenues due to the superhero bubble or due to good quality content.

```{r}
#Amaury Scatter plot
```

Let us now see the box plots of ratings (critics and audience) differentiated on the movie studio that produced them. This would help us compare the quality of the superhero movies between the studios (general consensus is that Marvel movies have better score and revenue than their DC counterparts). Through this we can also see if there are any outliers in the data (uncharacteristically high or low rated movies).

```{r}
ggplot(dff1, aes(x = reorder(studio, -imdb_rating, median), y = imdb_rating)) + 
  # plotting
  geom_boxplot(fill = "#cc9a38", color = "#473e2c") + stat_boxplot(geom="errorbar") +
  # formatting
  ggtitle("IMDB Score of Marvel vs. DC movies",
          subtitle = "Boxplots of IMDB score by movie studio") +
  labs(x = "Movie Studio", y = "IMDBScore") +
  theme_grey(16) +
  theme(plot.title = element_text(face = "bold")) +
  theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
  theme(plot.caption = element_text(color = "grey68"))
```
This graph shows that while Marvel and DC movies have a similar median rating on IMDB (7 vs. 6.5), the interquartile range for DC movies is much larger. This means that Marvel movies are more consistent when compared to DC movies in the matters of IMDB scores. There is more variability for DC movies, 25% of which have an IMDB score of less than 5.2.
It is worth noting that the best rated DC movie achieves a higher IMDB score than the best rated Marvel movie. The outliers (uncharacteristically low rated movies) in the Marvel movies according to the ratings are "The Fantastic Four(1994)", "Fantastic Four (2015)" , "Ghost Rider: Spirit of Vengeance" and the "Captain America (1991)" movies. It looks like there are only 3 outliers but in actuality there are 4 (Two movies The Fantastic Four(1994) and Ghost Rider: Spirit of Vengeance have the same imdb rating of 4.3).

What about the Rotten Tomatoes scores?
```{r}
# boxplot bystudio 
dfn2 = df[!is.na(df$critic_score_rt),]
ggplot(dfn2, aes(x = reorder(studio, -critic_score_rt, median), y = critic_score_rt)) + 
  # plotting
  geom_boxplot(fill = "#cc9a38", color = "#473e2c") + stat_boxplot(geom="errorbar") + 
  # formatting
  ggtitle("Rotten Tomatoes Critic Score",
          subtitle = "Boxplots of RT Critic score by studio") +
  labs(x = "studio", y = "Critic score (%)") +
  theme_grey(16) +
  theme(plot.title = element_text(face = "bold")) +
  theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
  theme(plot.caption = element_text(color = "grey68"))
```
It is worth taking a pause to interpret this graph. Whereas the audience ratings (IMDB, Rotten Tomatoes) had a similar median for Marvel and DC movies, the critic scores are much more severe. The median for marvel movies is 77%, whereas the median for DC movies is 55%. Critics clearly seem to prefer Marvel movies, while audiences are more undecided.


One can still argue that we haven't considered inflation, when we did the revenue analysis. So we will see how many times on an average the superhero movies are being watched (in the US) over the years. To do this we will divide the domestic gross revenue generated by a movie by the average ticket price during the year in which the movie was released. This will give us the average number of times that particular movie was viewed, then we groupthem by year and get the mean of average number of times all the superhero movies released in that year were watched. 

```{r,echo=FALSE,warning=FALSE,results='hide',fig.keep='all',message=FALSE}
g=read.csv("avg_ticket price.csv")
options(warn=-1)
g$Year <- as.numeric(as.character(g$Year))
#One year is in a different format than the other years, so we had to manually add it.
g[30,1]=1989
g$Average.Ticket.price <- as.numeric(as.character(substring(g$Average.Ticket.price,2,)))
colnames(g)[1] <- "year_of_release"
colnames(g)[2] <- "price"
hg = suppressWarnings(right_join(dff1,g, by=c("year_of_release")))
hg1=na.omit(hg)
hg1=mutate(hg1, no_of_views=(gross_usa/price))
results2=data.frame(hg1 %>%
  group_by(year_of_release) %>%
  summarise(avg_views = mean(no_of_views, na.rm = TRUE)))
ggplot(results2, aes(year_of_release, y=avg_views)) + 
  geom_line() +
  geom_point() +
  ggtitle("Average views for superhero movies in USA over the years") +
  xlab("Year") + 
  ylab("average views in USA")
```

Looking at the plot we can see that when accounting for inflation, Batman, which was released in 1989 got the highest  audience and Superman which was released in 1978 got a similar number of views. Total number of views has dropped since then and rose again in 1998 (Blade I) till 2002 (year during which the first Spider-man movie was released, and Blade II was released). The movies released in 2012 also got a similar amout of views as the ones in 2002. Four movies were released in 2012 and the major movies that caused this spike in viewership are The Avengers and the Dark Knight Rises. We can see that there has been a constant rise in viewership from 2015 to 2018. So we can see that from the past 5 years there has been a constant increase in the viewership of the super-hero movies, but their viewership was not as high as the first Batman and Superman movies. This can be due to the intial excitement of comic fans to see their favorite characters come live on the screen.

Since we have seen that the trend in viewership for the superhero movies has indeed been rising for the past 5 years, let us see the trend in the theater allocation. To do this we will merge our dataset with a different one which has the number of theaters present in a year in the US (obtained from the National Association of Theater Owners website). Then we will get the ratio of number of theater allocated per movie by dividing the number of theaters allocated for this movie by the total number of theaters in the US in the year this movie released. We then group by year and plot the average number of theaters allocated for super-hero movies over the years. Unfortunately we only have theater count in US details from the year 1995, so we will lose 11 movies that came before 1995 after the merging of both the datasets.

```{r}
theaters=read.csv("theaters_in_us.csv")
#Making the comma seperated factor values into numeric
theaters[,2:4] <- lapply(theaters[,2:4],function(x){as.numeric(gsub(",", "", x))})
#Changing the name of the column to facilitate the merge
colnames(theaters)[which(names(theaters) == "Theaters")] <- "year_of_release"
dff2 <- dff1 %>% right_join(theaters, by=c("year_of_release"))
#removing movies that lack theater details
dff3=dff2[!is.na(dff2$theaters),]
dff3= mutate(dff3, theater_ratio=theaters/Total)
results3=data.frame(dff3 %>%
  group_by(year_of_release) %>%
  summarise(avg_theaters = mean(theater_ratio, na.rm = TRUE)))
ggplot(results3, aes(year_of_release, y=avg_theaters)) + 
  geom_line() +
  geom_point() +
  ggtitle("Average ratio of theaters allocated for superhero movies in USA over the years") +
  xlab("Year") + 
  ylab("average ratio of theaters allocated in USA")
```

We can see that the average ratio of theaters allocated to these movies with the theaters present in those years has been increasing overall. There was a drop in the average number of theaters allocated in the year 1997, two movies namely, Batman and Robin, and Steel were released that year. Batman and Robin had 0.3933 as the ratio of number of theaters it was allocated (which is comparable to the previous year) but the average ratio is brought down because the movie "Steel" (which had a ratio of 0.168). This is because it was not based on a very famous superhero, and therefore was not allocated a lot of theaters. The small downs in the trend are mostly due to lesser number of theaters being allocated to not so famous superhero characters like "catwoman". We can clearly see an increasing trend in the ratio of number theaters displaying superhero movies, and in recent years we can see that over 70% of the theaters in the US are playing a superhero movie should one be released during that time. This clearly proves the claim made by Mr.Scorsese that these movies are taking up more no of theaters, making it hard for the smaller movies released during the same time to even get some audience. 

Now let us see if there is any correlation between the revenue generated by a movie and the no of theaters it was allocated. You can hover over the points to see what movies those points represent.
```{r}
x <- list(
  title = "No of theaters allocated"
)
y <- list(
  title = "Gross Domestic Revenue in Millions")
p <- plot_ly(dff3, x = ~theaters, y = ~gross_usa, type = 'scatter', mode = 'markers',
        text = ~paste('name: ', name)) %>% layout(xaxis = x, yaxis = y, title="Theaters allocated v/s gross domestic revenue") %>%  add_lines(y = ~fitted(loess(gross_usa ~ theaters)),
            line = list(color = 'rgba(7, 164, 181, 1)'),
            name = "Loess Smoother") %>% config(displayModeBar = F)

ggplotly(p)
```

Though it is not very strong, there is a correlation between number of theaters allocated for the movie and the revenue it generated. This means that other movies that are not getting enough movie theaters because of superhero movies, are indeed losing on some revenue and in turn are not getting the viewership they deserve. We can also see that after 3500 theaters, there is a fast rise in the gross domestic revenue obtained by the movie.

<h1>Possible Solution</h1>
Let us now look at how much of the domestic revenue of a superhero movie is obtained on its opening weekend. To do this, we will divide the domestic revenue obtained in the first week by the domestic revenue generated by the movie in its entire run-time. This tells us what part of the overall revenue of these movies is obtained in the first week. We will then use bar plots to see what part of the domestic revenue is obtained in the first week itself for most of these movies. (Note: The bars are ordered according to the ordinal order of ratio i.e. from 0.1 to 0.5 and not based on number of movies having this ratio).
```{r, }
#removing rows with NAs in the opening weekend and USA gross columns
df=na.omit(df, cols = c("opening_weekend_usa", "gross_usa"))
df=mutate(df, r=round(opening_weekend_usa/gross_usa, digits=1))
ggplot(df, aes(r)) + 
  geom_bar() + 
  ggtitle("Part of domestic revenue obtained within the first week") + theme(plot.title = element_text(hjust = 0.5))+
  xlab("ratio of opening week domestic gross to overall domestic gross") + 
  ylab("Number of movies")
```

From this bar plot we can see that most of the movies (nearly 68% of the movies in the dataset) get more than 40% of their domestic revenue within the first week of their runtime itself. Now let use see how the trend of vi

```{r}
hg2=mutate(hg1, no_of_views_in_1stweek=(opening_weekend_usa/price)/1000000)
results5=data.frame(hg2 %>%
  group_by(year_of_release) %>%
  summarise(avg_views_week1 = mean(no_of_views_in_1stweek, na.rm = TRUE)))
ggplot(results5, aes(year_of_release, y=avg_views_week1)) + 
  geom_line() +
  geom_point() +
  ggtitle("Average views in week 1 for superhero movies in USA over the years") +
  xlab("Year") + 
  ylab("average views (in millions) per week 1 in USA")
```
Though there are lot of ups and downs we can see that the overall trend has been rising, signaling that more people are watching superhero movies withtin the first week itself. This can be due to many possible reasons. One reason that strikes us is the fear of spoiler filled reviews. In the current trend of giving spoiler filled reviews to movies online people are afraid that if they wait for too long they might have to learn about the fate of their favorite superheroes through spoilers or leaked post credit scenes. (This is not accounting for the increase in the population overa these years).

This sparks a possible solution to the theater allotment issue. If a theater runs 4 shows of a movie per a day, and if it is plannnig on showcasing a superhero movie, it can showcase the superhero movie in all the 4 shows for the first week and from the second week can showcase the superhero movie in 2 of its prime slots and another movie in the rest of the slots. This would help other movies (that were released at the same time as the superhero movies) get the viewership they deserve.

To see why more superhero movies are being made by the production companies in the recent years, we will have to look at the average return on investment by year of these superhero movies v/s the normal top 100 highest grossing movies from our main dataset. For this analysis, we have used an updated version of our main dataset. To keep the comparision of return on investment over the years fair, we have constructed our updated dataset by removing all the superhero movies from our main dataset. 

```{r}
library(ggplot2)
library(gganimate)

#Reference https://www.r-graph-gallery.com/287-smooth-animation-with-tweenr.html
superheroes_ROI <- (dff1$gross_worldwide/dff1$budget)
superheroes_year <- dff1$year_of_release
df_database=read.csv('main_ds_without_superhero.csv')
#superhero is for superhero database, regular is for the regular dataset
df_database=mutate(df_database,returnperdollar=revenue/budget)
regular_ROI <- (df_database["revenue"]/df_database["budget"])
regular_year <- df_database["year"]

superhero_roi_frame = data.frame(year=superheroes_year,ROI=superheroes_ROI)
mean_superhero_roi_frame <- aggregate(superhero_roi_frame[, 2], list(superhero_roi_frame$year), mean)[-c(1,2),]
mean_superhero_roi_frame = mean_superhero_roi_frame[!is.na(mean_superhero_roi_frame$x),]
mean_superhero_roi_frame$type = rep("Superhero", nrow(mean_superhero_roi_frame))
regular_roi_frame = data.frame(year=regular_year,ROI=regular_ROI)
mean_regular_roi_frame <- aggregate(regular_roi_frame[,2],list(regular_roi_frame$year),mean)[-c(40),]
mean_regular_roi_frame$type = rep("Regular", nrow(mean_regular_roi_frame))
mean_merged = rbind(mean_superhero_roi_frame,mean_regular_roi_frame)

goo <- mean_merged %>%
    ggplot( aes(Group.1,x, color=type,group=type)) +
    geom_line() + geom_point(aes(group = type))+guides(color = guide_legend(reverse = TRUE)) +
    ggtitle("Average Return on Investment of Superhero and regular Movies") +
    ylab("ROI (revenue-budget) in millions") + ylab("Year")+transition_reveal(Group.1) + ease_aes('linear')
animate(goo, duration = 8, fps = 20, width = 800, height = 800, renderer = gifski_renderer())
anim_save("output.gif")
```
From the above animated graph we can see that the regular movie's Return on Investment line shows that ROI for movies overall has increased over time, the superhero ROI line increases much faster. This indicates that superhero movies are more bankable. That is, studios can expect a higher return from superhero movies than from regular movies. This explains the trend of movie studios jumping on the "superhero movie bandwagon". Since they can expect to make more money on average from those movies, it is in their financial interest to focus particularly on this category of movies.


```{r}
```


Note: We are considering all the movies that are based on Marvel comics (which includes, the movies like Blade, Constantine and Howard the duck).